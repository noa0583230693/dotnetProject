using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using WebApplication1.Data;
using WebApplication1.Model;

namespace WebApplication1.Controllers
{

    [ApiController]
    [Route("api/assignments")]
    public class ProjectAssignmentController : ControllerBase
    {
        /// <summary>
        /// שליפת כל השיוכים
        /// </summary>
        [HttpGet]
        public IActionResult GetAllAssignments()
        {
            return Ok(FakeContext.Assignments);
        }

        /// <summary>
        /// שליפת שיוך בודד לפי מזהה
        /// </summary>
        [HttpGet("{id}")]
        public IActionResult GetAssignmentById(int id)
        {
            var assignment = FakeContext.Assignments.FirstOrDefault(a => a.Id == id);
            if (assignment == null)
                return NotFound("שיוך לא נמצא");

            return Ok(assignment);
        }

        /// <summary>
        /// הוספת שיוך חדש בין עובד לפרויקט
        /// </summary>
        [HttpPost]
        public IActionResult AddAssignment(ProjectAssignment assignment)
        {
            assignment.Id = FakeContext.Assignments.Max(a => a.Id) + 1;
            FakeContext.Assignments.Add(assignment);
            return Ok(assignment);
        }

        /// <summary>
        /// עדכון נתוני שיוך קיים
        /// </summary>
        [HttpPut("{id}")]
        public IActionResult UpdateAssignment(int id, ProjectAssignment updated)
        {
            var assignment = FakeContext.Assignments.FirstOrDefault(a => a.Id == id);
            if (assignment == null)
                return NotFound("שיוך לא נמצא");

            assignment.ProjectId = updated.ProjectId;
            assignment.EmployeeId = updated.EmployeeId;
            assignment.EmployeeRoleInProject = updated.EmployeeRoleInProject;

            return Ok(assignment);
        }

        /// <summary>
        /// מחיקת שיוך
        /// </summary>
        [HttpDelete("{id}")]
        public IActionResult DeleteAssignment(int id)
        {
            var assignment = FakeContext.Assignments.FirstOrDefault(a => a.Id == id);
            if (assignment == null)
                return NotFound("שיוך לא נמצא");

            FakeContext.Assignments.Remove(assignment);
            return Ok("נמחק בהצלחה");
        }

        /// <summary>
        /// פעולה נוספת: שליפת כל השיוכים של פרויקט מסוים
        /// </summary>
        [HttpGet("by-project/{projectId}")]
        public IActionResult GetAssignmentsByProject(int projectId)
        {
            var list = FakeContext.Assignments
                .Where(a => a.ProjectId == projectId)
                .ToList();

            return Ok(list);
        }
    }
}

