using Microsoft.AspNetCore.Mvc;
using WebApplication1.Data;
using WebApplication1.Model;

namespace WebApplication1.Controllers
{

    [ApiController]
        [Route("api/projects")]
        public class ProjectController : Controller
        {
            /// <summary>
            /// שליפת רשימת כל הפרויקטים
            /// </summary>
            [HttpGet]
            public IActionResult GetAllProjects()
            {
                return Ok(FakeContext.Projects);
            }

            /// <summary>
            /// שליפת פרויקט בודד לפי מזהה
            /// </summary>
            [HttpGet("{id}")]
            public IActionResult GetProjectById(int id)
            {
                var project = FakeContext.Projects.FirstOrDefault(p => p.Id == id);
                if (project == null)
                    return NotFound("פרויקט לא נמצא");

                return Ok(project);
            }

            /// <summary>
            /// הוספת פרויקט חדש
            /// </summary>
            [HttpPost]
            public IActionResult AddProject(Project project)
            {
                project.Id = FakeContext.Projects.Max(p => p.Id) + 1;
                FakeContext.Projects.Add(project);
                return Ok(project);
            }

            /// <summary>
            /// עדכון פרויקט קיים
            /// </summary>
            [HttpPut("{id}")]
            public IActionResult UpdateProject(int id, Project updated)
            {
                var project = FakeContext.Projects.FirstOrDefault(p => p.Id == id);
                if (project == null)
                    return NotFound("פרויקט לא נמצא");

                project.Name = updated.Name;
                project.Description = updated.Description;

                return Ok(project);
            }
        /// <summary>
        /// מחיקת פרויקט לפי מזהה
        /// </summary>
        [HttpDelete("{id}")]
        public IActionResult DeleteProject(int id)
        {
            var project = FakeContext.Projects.FirstOrDefault(p => p.Id == id);
            if (project == null)
                return NotFound("פרויקט לא נמצא");

            FakeContext.Projects.Remove(project);
            return Ok($"הפרויקט עם מזהה {id} נמחק בהצלחה");
        }

        /// <summary>
        /// פעולה נוספת: חיפוש פרויקטים לפי מילה בשם
        /// </summary>
        [HttpGet("search/{keyword}")]
            public IActionResult SearchProject(string keyword)
            {
                var results = FakeContext.Projects
                    .Where(p => p.Name.Contains(keyword, StringComparison.OrdinalIgnoreCase))
                    .ToList();

                return Ok(results);
            }
        }
    }
